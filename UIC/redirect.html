<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Redirecting to video...</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
</head>
<body>
  <p id="msg">Loading videoâ€¦</p>
  <p>If you are not automatically redirected in 5 seconds, please click <a id="fallbackLink" href="#" target="_top" rel="noopener">here</a>.</p>
  <noscript>
    <p><strong>It seems that JavaScript in your browser is disabled.</strong> To access the video, please copy the value after <code>video=</code> in the URL and open <code>https://youtu.be/VIDEO_ID</code> manually.</p>
    <p>You should also contact the professor to inform him that your visualization of the video has not been registered.</p>
  </noscript>
  <script>
    (async function() {
      const params = new URLSearchParams(window.location.search);
      const student = params.get('student') || '';
      const email = params.get('email') || '';
      const video = params.get('video') || '';
      const loggerUrl = 'https://script.google.com/macros/s/AKfycbwMowDDuUEbpxuZKzi5NI95AFxNUFPc9tLQgMaAeuV4704vuysjBK0wVdXEDERhmr4scg/exec';

      if (!video) {
        document.getElementById('msg').textContent = 'Missing video ID in the URL.';
        return;
      }

      const yt = 'https://youtu.be/' + encodeURIComponent(video);
      const a = document.getElementById('fallbackLink');
      a.href = yt;

      // Log click (fire-and-forget)
      fetch(`${loggerUrl}?video=${encodeURIComponent(video)}&student=${encodeURIComponent(student)}&email=${encodeURIComponent(email)}`)
        .catch(() => { /* ignore logging errors */ })
        .finally(() => {
          // Then redirect top-level
          window.location.replace(yt);
        });

      // Safety: if fetch hangs, still redirect after 4s
      setTimeout(() => {
        window.location.replace(yt);
      }, 4000);
    })();
  </script>
</body>
</html>
