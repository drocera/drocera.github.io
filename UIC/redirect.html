<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Redirecting to video...</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
</head>
<body>
  <p id="msg">Redirecting you to the videoâ€¦</p>
  <script>
    (async function() {
      const params = new URLSearchParams(window.location.search);
      const studentID = params.get('studentID') || '';
      const lname = params.get('lname') || '';
      const video = params.get('video') || '';
      if (!video) {
        document.getElementById('msg').textContent = 'Missing video ID in the URL.';
        return;
      }

      // Log click (fire-and-forget)
      const loggerUrl = 'https://script.google.com/macros/s/AKfycbwMowDDuUEbpxuZKzi5NI95AFxNUFPc9tLQgMaAeuV4704vuysjBK0wVdXEDERhmr4scg/exec';
      fetch(`${loggerUrl}?video=${encodeURIComponent(video)}&student=${encodeURIComponent(studentID)}&lname=${encodeURIComponent(lname)}`)
        .catch(() => { /* ignore logging errors */ })
        .finally(() => {
          // Then redirect top-level
          window.location.replace('https://youtu.be/' + encodeURIComponent(video));
        });

      // Safety: if fetch hangs, still redirect after 1s
      setTimeout(() => {
        window.location.replace('https://youtu.be/' + encodeURIComponent(video));
      }, 5000);
    })();
  </script>
</body>
</html>
